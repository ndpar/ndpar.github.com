<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title> - page 7 - Side Notes</title>

  <link rel="icon" href="/favicon.ico">
  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="">
  <link rel="alternate" type="application/rss+xml" title="Side Notes" href="">

  <link href='/stylesheets/all-3946f92fb0c0a9c01c341f255decb03c.css' media='all' rel='stylesheet' type='text/css'>

  <!-- MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript"
    src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML'></script>

</head>

  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="/">Side Notes</a>
  
    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
          
            
            <a class="page-link" href="/about/">About</a>
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        </div>
      </nav>
    
  </div>
</header>

    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <style>
  .pager { text-align: center; }
  .pager div.previous { float: left; }
  .pager div.next { float: right; }
</style>

<div class="home">

  

  <ul class="post-list">
    
      <li>
        
        <span class="post-meta">Jun 27, 2011</span>

        <h2>
          <a class="post-link" href="/2011/06/27/math-and-physics-of-benderama/">Math and Physics of Benderama</a>
        </h2>
        <div class="entry-content">
          <p>The last episode of <a href="http://theinfosphere.org/Benderama">Futurama</a> has interesting formula involved. The entire plot is based on the Professor’s latest invention — <a href="http://en.wikipedia.org/wiki/Banach&#8211;Tarski_paradox">Banach-Tarski</a> Dupla-Shrinker — the machine that produces two copies of any object at a 60% scale. It was just a matter of time when Bender found a proper usage of this machine: to replicate himself. Then two small copies of Bender replicated themselves making four smaller copies, and so forth. At some point the Professor horrified the crew that if they don’t stop this unlimited growth, the total mass of all Benders will eventually be so big that the entire Earth will be consumed during the process of replication. As a proof he demonstrated this formula of the mass of all generations of Bender</p>

<p><img class="center" src="http://pool.theinfosphere.org/images/thumb/0/04/Benderama_Maths.png/800px-Benderama_Maths.png" /></p>

<p>This is a perfect toy for a science geek. The first obvious question it brings: is this formula mathematically correct? As it turns out, it is not. Considering the scale of 60%, the cubic dependency of volume on linear dimension, and the constant density of all copies, the formula should be the following</p>

<script type="math/tex; mode=display">M = \displaystyle\sum\limits_{n=0}^\infty 2^n\left[\left(\frac{3}{5}\right)^{3n} M_0\right] = \displaystyle\sum\limits_{n=0}^\infty 2^n\left[\left(\frac{27}{125}\right)^n M_0\right] = \displaystyle\sum\limits_{n=0}^\infty\left(\frac{54}{125}\right)^n M_0 = \frac{125}{71} M_0</script>

<p>As you can see the total mass of infinite number of Benders actually converges to approximately 1.76 <em>M</em><sub>0</sub>. So from Math perspective there is nothing to worry about. But what if our assumption of constant density is invalid. Would it be a problem from Physics perspective? Let’s see.</p>

<p>Knowing that every new copy has a size of 0.6 of the original it was made from, we have the following formula for the size of Bender in the <em>n</em><sup>th</sup> generation</p>

<script type="math/tex; mode=display">L_n = 0.6^n L_0</script>

<p>This exponential function becomes very small pretty soon. In the <a href="http://www.wolframalpha.com/input/?i=0.6%5E154">154</a><sup>th</sup> generation it already reaches the <a href="http://en.wikipedia.org/wiki/Planck_length">Planck length</a>, after which the further replication is physically impossible. If we calculate the total mass of 154 Bender’s generations using the Professor’s formula, we get <a href="http://www.wolframalpha.com/input/?i=H%28154%29">H(154)</a> × <a href="http://www.peelified.com/Futurama-Forum-1/Topic-4095-0-Benders_Weight.html">238</a> kg ≈ 1,337.56 kg, which is nothing comparing to the Earth mass.</p>

<p>So we have to admit that from both Math and Physics perspective the Professor was wrong, and there was no real threat to the Earth.</p>

<p>Although the Professor’s formula doesn’t describe the replication process adequately, it’s still a beautiful piece of Math because it’s a formula of <a href="http://en.wikipedia.org/wiki/Harmonic_series_(mathematics)">harmonic series</a>. If you want to know why harmonic series is beautiful and which real processes it describes, read this nice <a href="http://plus.maths.org/content/perfect-harmony">article</a> of John H. Webb.</p>

<p>And don’t miss the next <a href="http://theinfosphere.org/Ghost_in_the_Machines">episode</a> of Futurama this Thursday :-)</p>


        </div>
        
      </li>
    
      <li>
        
        <span class="post-meta">Jun 8, 2011</span>

        <h2>
          <a class="post-link" href="/2011/06/08/functional-groovy-switch-statement/">Functional Groovy switch statement</a>
        </h2>
        <div class="entry-content">
          <p>In the previous <a href="/2011/06/01/reversing-groovy-switch-statement">post</a> I showed how to replace chained if-else statements in Groovy with one concise switch. It was done for the special case of if-stement where every branch was evaluated using the same condition function. Today I want to make a generalization of that technique by allowing to use different conditionals.</p>

<p>Suppose your code looks like this:</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">if</span> <span class="o">(</span><span class="n">param</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">&#x7b;</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="s1">'even'</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="o">&#x7d;</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">param</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">&#x7b;</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="s1">'threeven'</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="o">&#x7d;</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="mi">0</span> <span class="o">&lt;</span> <span class="n">param</span><span class="o">)</span> <span class="o">&#x7b;</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="s1">'positive'</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="o">&#x7d;</span> <span class="k">else</span> <span class="o">&#x7b;</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="s1">'negative'</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="o">&#x7d;</span></div></div></pre></div></figure>

<p>As long as every condition operates on the same parameter, you can replace the entire chain with a switch. In this scenario <code class="highlighter-rouge">param</code> becomes a switch parameter and conditions become <code class="highlighter-rouge">case</code> parameters of Closure type. The only thing we need to do is to override <code class="highlighter-rouge">Closure.isCase()</code> method as I described in the previous post. The safest way to do it is to create a category class:</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kd">class</span> <span class="nc">CaseCategory</span> <span class="o">&#x7b;</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">isCase</span><span class="o">(</span><span class="n">Closure</span> <span class="n">casePredicate</span><span class="o">,</span> <span class="n">Object</span> <span class="n">switchParameter</span><span class="o">)</span> <span class="o">&#x7b;</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="n">casePredicate</span><span class="o">.</span><span class="na">call</span> <span class="n">switchParameter</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="o">&#x7d;</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="o">&#x7d;</span></div></div></pre></div></figure>

<p>Now we can replace if-statement with the following switch:</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">use</span> <span class="o">(</span><span class="n">CaseCategory</span><span class="o">)</span> <span class="o">&#x7b;</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="k">switch</span> <span class="o">(</span><span class="n">param</span><span class="o">)</span> <span class="o">&#x7b;</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">case</span> <span class="o">&#x7b;</span> <span class="n">it</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&#x7d;</span> <span class="o">:</span> <span class="k">return</span> <span class="s1">'even'</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">case</span> <span class="o">&#x7b;</span> <span class="n">it</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&#x7d;</span> <span class="o">:</span> <span class="k">return</span> <span class="s1">'threeven'</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">case</span> <span class="o">&#x7b;</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">it</span> <span class="o">&#x7d;</span>      <span class="o">:</span> <span class="k">return</span> <span class="s1">'positive'</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">default</span>              <span class="o">:</span> <span class="k">return</span> <span class="s1">'negative'</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="o">&#x7d;</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="o">&#x7d;</span></div></div></pre></div></figure>

<p>We can actually go further and extract in-line closures:</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kt">def</span> <span class="n">even</span> <span class="o">=</span> <span class="o">&#x7b;</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="n">it</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="o">&#x7d;</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kt">def</span> <span class="n">threeven</span> <span class="o">=</span> <span class="o">&#x7b;</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="n">it</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="o">&#x7d;</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kt">def</span> <span class="n">positive</span> <span class="o">=</span> <span class="o">&#x7b;</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">it</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="o">&#x7d;</span></div></div></pre></div></figure>

<p>After which the code becomes even more readable:</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">use</span> <span class="o">(</span><span class="n">CaseCategory</span><span class="o">)</span> <span class="o">&#x7b;</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="k">switch</span> <span class="o">(</span><span class="n">param</span><span class="o">)</span> <span class="o">&#x7b;</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">case</span> <span class="n">even</span>     <span class="o">:</span> <span class="k">return</span> <span class="s1">'even'</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">case</span> <span class="n">threeven</span> <span class="o">:</span> <span class="k">return</span> <span class="s1">'threeven'</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">case</span> <span class="n">positive</span> <span class="o">:</span> <span class="k">return</span> <span class="s1">'positive'</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">default</span>       <span class="o">:</span> <span class="k">return</span> <span class="s1">'negative'</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="o">&#x7d;</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="o">&#x7d;</span></div></div></pre></div></figure>


        </div>
        
      </li>
    
      <li>
        
        <span class="post-meta">Jun 7, 2011</span>

        <h2>
          <a class="post-link" href="/2011/06/07/nothing-new-under-sun/">Nothing new under the Sun</a>
        </h2>
        <div class="entry-content">
          <p>Every generation of software developers needs its own fad. For my generation it was Agile, for generation before it was OOP, and before that it was another big thing. Gerald Weinberg, one of the most influential people in our industry, blogged yesterday about this issue. With over 50 years of experience in software development he knows what he is talking about. Read his <a href="http://secretsofconsulting.blogspot.com/2011/06/beyond-agile-programming.html">blog post</a> — he has a very good point.</p>

<p>P.S. I’m wondering what will be the next big thing. Will it be Cloud or <a href="/2013/01/15/embrace-big-data/">Big Data</a>?</p>


        </div>
        
      </li>
    
      <li>
        
        <span class="post-meta">Jun 5, 2011</span>

        <h2>
          <a class="post-link" href="/2011/06/05/multimethods-in-groovy/">Multimethods in Groovy</a>
        </h2>
        <div class="entry-content">
          <p>Every time I switch from Groovy to Java I have to remind myself that some things that seem so natural and work as expected in Groovy, don’t work in Java. One of such differences is method dispatching. Groovy supports <a href="http://en.wikipedia.org/wiki/Multiple_dispatch">multiple dispatch</a>, while Java does not. Therefore the following <a href="http://www.gigamonkeys.com/book/object-reorientation-generic-functions.html#multimethods">code</a> works differently in Groovy and Java:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public class A {
    public void foo(A a) { System.out.println("A/A"); }
    public void foo(B b) { System.out.println("A/B"); }
}
public class B extends A {
    public void foo(A a) { System.out.println("B/A"); }
    public void foo(B b) { System.out.println("B/B"); }
}
public class Main {
    public static void main(String[] args) {
        A a = new A();
        A b = new B();
        a.foo(a);
        b.foo(b);
    }
}

$ java Main
A/A
B/A

$ groovy Main.groovy
A/A
B/B
</code></pre></div></div>


        </div>
        
      </li>
    
      <li>
        
        <span class="post-meta">Jun 1, 2011</span>

        <h2>
          <a class="post-link" href="/2011/06/01/reversing-groovy-switch-statement/">Reversing Groovy switch statement</a>
        </h2>
        <div class="entry-content">
          <p>Recently I’ve been working on a Groovy code that had many methods with long multibranch conditionals like this:</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kt">def</span> <span class="nf">parse</span><span class="o">(</span><span class="n">message</span><span class="o">,</span> <span class="n">options</span><span class="o">)</span> <span class="o">&#x7b;</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">if</span> <span class="o">(</span><span class="n">options</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s1">'A'</span><span class="o">))</span> <span class="o">&#x7b;</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="n">parseARule</span> <span class="n">message</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="o">&#x7d;</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">options</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="mi">2</span><span class="o">))</span> <span class="o">&#x7b;</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="n">parseSmallDigitRule</span> <span class="n">message</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="o">...</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="o">&#x7d;</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">options</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">something</span><span class="o">))</span> <span class="o">&#x7b;</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="n">parseSomeRule</span> <span class="n">message</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="o">&#x7d;</span> <span class="k">else</span> <span class="o">&#x7b;</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="n">parseSomeOtherRule</span> <span class="n">message</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="o">&#x7d;</span>
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="o">&#x7d;</span></div></div></pre></div></figure>

<p>Although this code is working, it is hard to see which branch is called under which condition. It would be much better if we could replace this code with something like Lisp <code class="highlighter-rouge">cond</code> macro. The best candidate for such a task in Groovy would be a <code class="highlighter-rouge">switch</code> statement. If we could only refactor the code above to something like following, it would significantly improve readability:</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kt">def</span> <span class="nf">parse</span><span class="o">(</span><span class="n">message</span><span class="o">,</span> <span class="n">options</span><span class="o">)</span> <span class="o">&#x7b;</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">switch</span> <span class="o">(</span><span class="n">options</span><span class="o">)</span> <span class="o">&#x7b;</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="k">case</span> <span class="s1">'A'</span> <span class="o">:</span> <span class="k">return</span> <span class="n">parseARule</span><span class="o">(</span><span class="n">message</span><span class="o">)</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="k">case</span> <span class="mi">2</span>   <span class="o">:</span> <span class="k">return</span> <span class="n">parseSmallDigitRule</span><span class="o">(</span><span class="n">message</span><span class="o">)</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="o">...</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="k">case</span> <span class="o">...</span> <span class="o">:</span> <span class="k">return</span> <span class="n">parseSomeRule</span><span class="o">(</span><span class="n">message</span><span class="o">)</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="k">default</span>  <span class="o">:</span> <span class="k">return</span> <span class="n">parseSomeOtherRule</span><span class="o">(</span><span class="n">message</span><span class="o">)</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="o">&#x7d;</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="o">&#x7d;</span></div></div></pre></div></figure>

<p>Unfortunately, this code doesn’t work out of the box in Groovy, but it works if we do some metaprogramming.</p>

<p>The way <code class="highlighter-rouge">switch</code> statement works in Groovy is a bit <a href="http://docs.codehaus.org/display/GROOVY/Logical+Branching#LogicalBranching-switchstatement">different</a> than in Java. Instead of equals() it uses isCase() method to match case-value and switch-value. The default implementation of isCase() method falls back to equals() method, but some classes, including <a href="http://groovy.codehaus.org/groovy-jdk/java/util/Collection.html#isCase(java.lang.Object)">Collection</a>, override this behaviour. That’s why in Groovy you can do things like this:</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">switch</span> <span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="o">&#x7b;</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">case</span> <span class="o">[</span><span class="s1">'A'</span><span class="o">,</span><span class="s1">'E'</span><span class="o">,</span><span class="s1">'I'</span><span class="o">,</span><span class="s1">'O'</span><span class="o">,</span><span class="s1">'U'</span><span class="o">]</span> <span class="o">:</span> <span class="k">return</span> <span class="s1">'vowel'</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">case</span> <span class="mi">0</span><span class="o">..</span><span class="mi">9</span>                  <span class="o">:</span> <span class="k">return</span> <span class="s1">'digit'</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">case</span> <span class="n">Date</span>                  <span class="o">:</span> <span class="k">return</span> <span class="s1">'date'</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">default</span>                    <span class="o">:</span> <span class="k">return</span> <span class="s1">'something else'</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="o">&#x7d;</span></div></div></pre></div></figure>

<p>For our purposes we need some sort of reverse <code class="highlighter-rouge">switch</code>, where collection is used as a switch-value, and String and Integer are used as a case-value. To do this we need to override default implementation of isCase() method on String and Integer classes. It’s not possible in Java, but is very easy in Groovy. You can change method implementation globally by replacing it in corresponding meta class, or locally with the help of categories. Let’s create a category that swaps object and subject of isCase() method:</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kd">class</span> <span class="nc">CaseCategory</span> <span class="o">&#x7b;</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">isCase</span><span class="o">(</span><span class="n">String</span> <span class="n">string</span><span class="o">,</span> <span class="n">Collection</span> <span class="n">col</span><span class="o">)</span> <span class="o">&#x7b;</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="n">reverseCase</span><span class="o">(</span><span class="n">string</span><span class="o">,</span> <span class="n">col</span><span class="o">)</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="o">&#x7d;</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">isCase</span><span class="o">(</span><span class="n">Integer</span> <span class="n">integer</span><span class="o">,</span> <span class="n">Collection</span> <span class="n">col</span><span class="o">)</span> <span class="o">&#x7b;</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="n">reverseCase</span><span class="o">(</span><span class="n">integer</span><span class="o">,</span> <span class="n">col</span><span class="o">)</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="o">&#x7d;</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="c1">// Add more overloaded methods here if needed</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="kd">private</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">reverseCase</span><span class="o">(</span><span class="n">left</span><span class="o">,</span> <span class="n">right</span><span class="o">)</span> <span class="o">&#x7b;</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="n">right</span><span class="o">.</span><span class="na">isCase</span><span class="o">(</span><span class="n">left</span><span class="o">)</span>
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="o">&#x7d;</span>
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="o">&#x7d;</span></div></div></pre></div></figure>

<p>Now we can use this category to achieve the goal we stated at the beginning of this post:</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kt">def</span> <span class="nf">parse</span><span class="o">(</span><span class="n">message</span><span class="o">,</span> <span class="n">options</span><span class="o">)</span> <span class="o">&#x7b;</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="n">use</span> <span class="o">(</span><span class="n">CaseCategory</span><span class="o">)</span> <span class="o">&#x7b;</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="k">switch</span> <span class="o">(</span><span class="n">options</span><span class="o">)</span> <span class="o">&#x7b;</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">                <span class="k">case</span> <span class="s1">'A'</span> <span class="o">:</span> <span class="k">return</span> <span class="n">parseARule</span><span class="o">(</span><span class="n">message</span><span class="o">)</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">                <span class="k">case</span> <span class="mi">2</span>   <span class="o">:</span> <span class="k">return</span> <span class="n">parseSmallDigitRule</span><span class="o">(</span><span class="n">message</span><span class="o">)</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">                <span class="o">...</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">                <span class="k">case</span> <span class="o">...</span> <span class="o">:</span> <span class="k">return</span> <span class="n">parseSomeRule</span><span class="o">(</span><span class="n">message</span><span class="o">)</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">                <span class="k">default</span>  <span class="o">:</span> <span class="k">return</span> <span class="n">parseSomeOtherRule</span><span class="o">(</span><span class="n">message</span><span class="o">)</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="o">&#x7d;</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="o">&#x7d;</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="o">&#x7d;</span></div></div></pre></div></figure>

<p>If you are comfortable with global method replacement, you can amend String and Integer meta classes. In this case you don’t need to wrap <code class="highlighter-rouge">switch</code> statement with <code class="highlighter-rouge">use</code> keyword.</p>


        </div>
        
      </li>
    
  </ul>

  
  <div class="pager">
      
      <div class="previous">
          <a href="/page/8/index.html">&larr; Older Posts</a>
      </div>
      
      <span class="archive">
          <a href="/archive/">Archive</a>
      </span>
      
      <div class="next">
          <a href="/page/6/index.html">Newer Posts &rarr;</a>
      </div>
      
  </div>
  
  
</div>


      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-credit">

      <span class="footer-credit-left">
        Copyright &copy; 2009–2018 Andrey Paramonov
      </span>

      <span class="footer-credit-right">
        Powered by <a href="https://github.com/octopress/octopress">Octopress</a> •
        Hosted by <a href="https://github.com">GitHub</a>
      </span>

    </div>

  </div>

</footer>

  </body>

</html>
